    <Page x:Class="AccessManager.Views.RequestFormVIew"
          xmlns:conv="clr-namespace:AccessManager.Converters"
          xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
          xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
          xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
          xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
          xmlns:local="clr-namespace:AccessManager.Views"
          mc:Ignorable="d" 
          d:DesignHeight="700" d:DesignWidth="900"
          Title="RequestFormVIew" Background="{StaticResource BackgroundColor}">
    <Page.Resources>
        <conv:BoolToHasAccessConverter x:Key="BoolToHasAccessConverter"/>
        <conv:NullOrEmptyToBoolConverter x:Key="NullOrEmptyToBoolConverter"/>
    </Page.Resources>
    <ScrollViewer>
            <StackPanel Margin="20">
                <TextBlock Text="Форма заявки на доступ" FontSize="20" FontWeight="Bold" Margin="0,0,0,20"/>

                <!-- 1. ФИО, Табельный №, Должность, Телефон -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="300"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="ФИО:" Grid.Column="0" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1" Text="{Binding ApplicantFullName}"/>

                    <TextBlock Text="Табельный №:" Grid.Column="2" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="3" Text="{Binding ApplicantTabNumber}"/>
                </Grid>

                <!-- 2. Должность и телефон -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="300"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Должность:" Grid.Column="0" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1" Text="{Binding Position}"/>

                    <TextBlock Text="Телефон:" Grid.Column="2" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="3" Text="{Binding ContactPhone}"/>
                </Grid>

                <!-- 3. Действие и причина -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="300"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Действие:" Grid.Column="0" VerticalAlignment="Center"/>
                    <ComboBox Grid.Column="1" ItemsSource="{Binding ActionTypes}" SelectedItem="{Binding SelectedActionType}"/>

                    <TextBlock Text="Причина:" Grid.Column="2" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="3" Text="{Binding Reason}"/>
                </Grid>

                <!-- 4. Информационные ресурсы -->
                <TextBlock Text="Информационные ресурсы:" FontWeight="SemiBold" Margin="0,10,0,5"/>
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                       
                    </Grid.ColumnDefinitions>

                    <!-- Список всех ресурсов -->

                    <!-- Выбранные ресурсы -->
                    <StackPanel Grid.Column="0" Margin="10,0,0,0">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBox Text="{Binding ResourceSearchText}" Width="250" Margin="0,0,5,0"/>
                            <Button Content="🔍 Поиск" Command="{Binding SearchResourcesCommand}" Width="100"/>

                        <StackPanel Orientation="Vertical" Margin="60,0,0,0">
                            <CheckBox Content="Показать только ресурсы с почтой владельца"
                  IsChecked="{Binding ShowOnlyWithEmail}"
                  Command="{Binding FilterByEmailCommand}"
                  Margin="0,0,20,0"/>

                            <CheckBox Content="Показать только ресурсы, к которым есть доступ"
                  IsChecked="{Binding ShowOnlyAccessible}"
                  Command="{Binding FilterByAccessCommand}"/>
                        </StackPanel>
                    </StackPanel>
                        <TextBlock Text="Выбранные ресурсы:" FontWeight="SemiBold"/>
                    <ListView ItemsSource="{Binding SelectedRequestItems}"
          SelectedItem="{Binding SelectedResource}"
          Height="250"
          SelectionMode="Extended">

                        <!-- Стили строк (цвет текста зависит от владельца / почты) -->
                        <ListView.Resources>
                            <conv:NullOrEmptyToBoolConverter x:Key="NullOrEmptyToBoolConverter"/>

                            <Style TargetType="ListViewItem">
                                <Setter Property="Foreground" Value="Black"/>

                                <Style.Triggers>
                                    <!-- Если почты нет → красный -->
                                    <DataTrigger Binding="{Binding Resource.Email, Converter={StaticResource NullOrEmptyToBoolConverter}}" Value="True">
                                        <Setter Property="Foreground" Value="Red"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="ToolTip" Value="⚠ У владельца нет почты"/>
                                    </DataTrigger>

                                    <!-- Если почта есть → зелёный -->
                                    <DataTrigger Binding="{Binding Resource.Email, Converter={StaticResource NullOrEmptyToBoolConverter}}" Value="False">
                                        <Setter Property="Foreground" Value="Green"/>
                                        <Setter Property="ToolTip" Value="✅ Почта владельца найдена"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ListView.Resources>

                        <!-- Колонки -->
                        <ListView.View>
                            <GridView>

                                <!-- Колонка выбора -->
                                <GridViewColumn Header="Выбрать" Width="70">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding IsRequested}" HorizontalAlignment="Center"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="Имя" DisplayMemberBinding="{Binding Resource.Name}" Width="200"/>
                                <GridViewColumn Header="Описание" DisplayMemberBinding="{Binding Resource.Description}" Width="300"/>
                                <GridViewColumn Header="Почта владельца" DisplayMemberBinding="{Binding Resource.Email}" Width="250"/>

                                <!-- 🆕 Новая колонка -->
                                <GridViewColumn Header="Текущий доступ" Width="150">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding AccessLevel}"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>


                            </GridView>
                        </ListView.View>
                    </ListView>
                </StackPanel>
                </Grid>

                <!-- 5. Рабочие места -->
                <ComboBox Grid.Column="1"
                  ItemsSource="{Binding AvailableWorkstations}"
                  DisplayMemberPath="Name"
                  SelectedItem="{Binding SelectedWorkstation}"/>

                <!-- 6. Постоянно / Временно -->
            <StackPanel Orientation="Horizontal" Margin="0,10,0,20">
                <CheckBox Content="Временно" IsChecked="{Binding IsTemporary}" VerticalAlignment="Center"/>
                <TextBlock Text="с" Margin="10,0,5,0" VerticalAlignment="Center"/>
                <DatePicker SelectedDate="{Binding TemporaryFrom}" IsEnabled="{Binding IsTemporary}" Width="120"/>
                <TextBlock Text="по" Margin="10,0,5,0" VerticalAlignment="Center"/>
                <DatePicker SelectedDate="{Binding TemporaryUntil}" IsEnabled="{Binding IsTemporary}" Width="120"/>
            </StackPanel>

            <!-- Кнопки -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Сохранить черновик" Command="{Binding SaveDraftCommand}" Margin="0,0,10,0"/>
                    <Button Content="Отправить на согласование" Command="{Binding SubmitCommand}"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Page>
